<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JR Vibe Code – AI UI Builder</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://js.puter.com/v2/"></script>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.1.0"
  }
}
</script>
</head>
<body>
    <header>
        <div class="header-left">
            <div id="authContainer" class="auth-container">
                <button id="loginButton" class="header-button">Login</button>
                <div id="userInfo" class="hidden">
                    <span id="usernameContainer"></span>
                    <button id="logoutButton" class="header-button">Logout</button>
                </div>
            </div>
        </div>
        <div class="header-center">
            <span class="model-label puter-model-label">Model:</span>
            <select id="modelSelect" class="puter-model-select" aria-label="Select AI Model"></select>
            <span id="geminiModelLabel" class="model-label hidden">Gemini API Active</span>
        </div>
        <div class="header-right">
            <button id="settingsButton" class="header-button icon-button" aria-label="Open Settings">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42.12.64l2 3.46c.12.22.39.3.61.22l2.49 1c.52.4 1.08.73 1.69.98l-.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49.42l-.38-2.65c.61.25 1.17-.59 1.69.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22-.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                Settings
            </button>
        </div>
    </header>

    <div class="secondary-header">
        <div class="secondary-header-left">
            <input type="text" id="appProjectNameInput" class="app-project-name-input" value="Vibe Code Project" aria-label="App Project Name">
            <button id="newProjectButton" class="header-button icon-button" aria-label="Create New Project">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                New Project
            </button>
        </div>
        <div class="secondary-header-center">
             <div id="minimizedPanelRestoreArea" class="minimized-panel-restore-area">
                <!-- Restore buttons will be injected here by JS -->
            </div>
        </div>
        <div class="secondary-header-right">
            <div class="dropdown">
                <button id="downloadButton" class="header-button dropdown-toggle icon-button" aria-label="Download Options">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                    Download
                </button>
                <div class="dropdown-content">
                    <a href="#" id="downloadActiveFile">Download Active File</a>
                    <a href="#" id="downloadZip">Download Project as ZIP</a>
                </div>
            </div>
        </div>
    </div>

    <main id="mainContainer">
        <div id="aiToolsPanel" class="panel">
            <div class="panel-header">
                <h3>AI Tools</h3>
                <div>
                    <button id="aiHistoryButton" class="panel-header-button icon-button" aria-label="View AI Prompt History" title="View AI Prompt History">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.25 2.52.77-1.28-3.52-2.09V8H12z"/></svg>
                    </button>
                    <button id="toggleAiToolsPanelButton" class="panel-header-button panel-content-toggle" aria-label="Minimize AI Tools Panel" aria-expanded="true" title="Minimize AI Tools Panel">
                        <svg class="icon icon-toggle-panel" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
                    </button>
                </div>
            </div>
            <div id="aiToolsContent" class="panel-content">
                <div id="aiToolsSection1" class="ai-tool-section">
                    <h4 id="aiToolsSection1Title">1. Describe your UI for <span id="aiPromptFileTarget">index.html</span></h4>
                    <div id="aiToolsSection1Content">
                        <textarea id="generatePromptInput" rows="3" placeholder="e.g., a landing page hero section..."></textarea>
                        <div class="action-row">
                             <button id="generateMicrophoneButton" class="microphone-button" aria-label="Use Microphone for UI Description">
                                <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                            </button>
                            <button id="generateCodeButton">Generate Code ➔</button>
                        </div>
                        <p class="tip-text">Tip: Enter to submit, Shift+Enter for new line.</p>
                    </div>
                    <div id="generatedPromptDisplay" class="minimized-prompt-display hidden">
                        <p><strong>Your UI description:</strong></p>
                        <p id="displayedGeneratePrompt"></p>
                        <button id="editInitialPromptButton">Edit Description</button>
                    </div>
                </div>

                <div id="aiToolsSection2" class="ai-tool-section hidden">
                    <h4>2. Modify app (<span id="aiModifyFileTarget">index.html</span>)</h4>
                    <textarea id="modifyPromptInput" rows="2" placeholder="e.g., Change the background color to lightblue..."></textarea>
                    <div class="action-row">
                        <button id="modifyMicrophoneButton" class="microphone-button" aria-label="Use Microphone for Modify Request">
                           <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                        </button>
                        <button id="modifyCodeButton">Modify Code ➔</button>
                    </div>
                </div>

                <div id="aiToolsSection3" class="ai-tool-section hidden">
                    <h4>3. Edit Element (in index.html)</h4>
                    <button id="selectElementButton">Select Element to Edit</button>
                    <div id="elementEditorControls" class="hidden" style="margin-top: 10px;">
                        <p class="editing-label">Editing: <span id="selectedElementIdentifier">N/A</span></p>
                        
                        <label for="elementTextContent">Text Content:</label>
                        <textarea id="elementTextContent" rows="2" placeholder="Element text..."></textarea>

                        <div class="control-grid two-columns">
                            <div>
                                <label for="elementColor">Text Color:</label>
                                <input type="color" id="elementColor" value="#000000">
                            </div>
                            <div>
                                <label for="elementBgColor">Background Color:</label>
                                <input type="color" id="elementBgColor" value="#FFFFFF">
                            </div>
                        </div>
                        <div class="control-grid two-columns">
                            <div>
                                <label for="elementWidth">Width:</label>
                                <input type="text" id="elementWidth" placeholder="e.g., 100px or 50%">
                            </div>
                            <div>
                                <label for="elementHeight">Height:</label>
                                <input type="text" id="elementHeight" placeholder="e.g., 50px or auto">
                            </div>
                        </div>
                        <div class="control-grid two-columns">
                            <div>
                                <label for="elementPadding">Padding:</label>
                                <input type="text" id="elementPadding" placeholder="e.g., 10px">
                            </div>
                            <div>
                                <label for="elementMargin">Margin:</label>
                                <input type="text" id="elementMargin" placeholder="e.g., 10px">
                            </div>
                        </div>
                        <div class="control-grid three-columns">
                            <div>
                                <label for="elementPosition">Position:</label>
                                <select id="elementPosition">
                                    <option value="">Default</option>
                                    <option value="static">Static</option>
                                    <option value="relative">Relative</option>
                                    <option value="absolute">Absolute</option>
                                    <option value="fixed">Fixed</option>
                                    <option value="sticky">Sticky</option>
                                </select>
                            </div>
                            <div>
                                <label for="elementDisplay">Display:</label>
                                <select id="elementDisplay">
                                    <option value="">Default</option>
                                    <option value="block">Block</option>
                                    <option value="inline">Inline</option>
                                    <option value="inline-block">Inline-Block</option>
                                    <option value="flex">Flex</option>
                                    <option value="grid">Grid</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                             <div>
                                <label for="elementTextAlign">Alignment:</label>
                                <select id="elementTextAlign">
                                    <option value="">Default</option>
                                    <option value="left">Left</option>
                                    <option value="center">Center</option>
                                    <option value="right">Right</option>
                                    <option value="justify">Justify</option>
                                </select>
                            </div>
                        </div>
                         <div class="control-grid two-columns">
                            <div>
                                <label for="elementBorder">Border:</label>
                                <input type="text" id="elementBorder" placeholder="e.g., 1px solid black">
                            </div>
                            <div>
                                <label for="elementBorderRadius">Corners (Radius):</label>
                                <input type="text" id="elementBorderRadius" placeholder="e.g., 5px or 50%">
                            </div>
                        </div>
                        
                        <label for="elementCustomCSS">Custom CSS rules:</label>
                        <textarea id="elementCustomCSS" rows="3" placeholder="e.g., box-shadow: 2px 2px 5px grey;&#10;transform: rotate(5deg);"></textarea>
                        
                        <p class="ai-edit-label">Or describe changes with AI:</p>
                        <textarea id="editElementPromptInput" rows="2" placeholder="e.g., make this button rounded with a blue border"></textarea>
                        
                        <div class="element-editor-buttons">
                            <button id="saveManualElementChangesButton">Apply Manual Edits</button>
                            <button id="applyElementAIEditButton">Apply AI Edit</button>
                        </div>
                    </div>
                </div>

                <div class="ai-tool-section" id="codeCheckpointsSection">
                    <h4>Code Checkpoints</h4>
                    <button id="createCheckpointButton" class="checkpoint-button icon-button" aria-label="Create a new checkpoint">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        Create Checkpoint
                    </button>
                    <button id="viewRestoreCheckpointsButton" class="checkpoint-button icon-button" aria-label="View and restore checkpoints">
                         <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.25 2.52.77-1.28-3.52-2.09V8H12z"/></svg>
                        View & Restore Checkpoints
                    </button>
                    <p id="checkpointsStatus" class="checkpoints-status-text">No checkpoints created yet.</p>
                </div>
            </div>
        </div>
        <div class="panel-resizer" id="resizerAiEditor"></div>
        <div id="codeEditorPanel" class="panel">
            <div class="panel-header">
                <h3 id="codePanelTitle">Code Editor: No file selected</h3>
                <div>
                    <button id="filesButton" class="panel-header-button icon-button" aria-label="Toggle File Explorer" title="Toggle File Explorer">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H2C.89 4 0 4.89 0 6v12c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                        Files
                    </button>
                    <button id="toggleCodeEditorPanelButton" class="panel-header-button panel-content-toggle" aria-label="Minimize Editor Panel" aria-expanded="true" title="Minimize Editor Panel">
                         <svg class="icon icon-toggle-panel" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
                    </button>
                </div>
            </div>
            <div id="codeFilesContent" class="panel-content">
                <div id="fileExplorer" class="hidden">
                    <div class="file-explorer-toolbar">
                        <button id="createNewFileButton" class="panel-header-button icon-button" aria-label="Create New File" title="Create New File">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V9l-7-7zm4 18H7v-2h10v2zm0-4H7v-2h10v2zm-2-4V3.5L19.5 9H15z"/></svg>
                            New File
                        </button>
                        <button id="createNewFolderButton" class="panel-header-button icon-button" aria-label="Create New Folder" title="Create New Folder">
                             <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                            New Folder
                        </button>
                        <input type="file" id="uploadFileInput" class="hidden" multiple aria-hidden="true">
                        <button id="uploadFileTriggerButton" class="panel-header-button icon-button" aria-label="Upload Files" title="Upload Files">
                             <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/></svg>
                            Upload File(s)
                        </button>
                         <button id="deleteAllFilesButton" class="panel-header-button icon-button" aria-label="Delete All Project Files" title="Delete All Project Files">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"></path></svg>
                            Delete All
                        </button>
                    </div>
                    <div id="newFileFolderInputContainer" class="hidden" style="margin-bottom: 10px;">
                        <input type="text" id="newFileFolderNameInput" placeholder="Enter name..." />
                        <button id="saveNewFileFolderButton" class="panel-header-button">Save</button>
                        <button id="cancelNewFileFolderButton" class="panel-header-button">Cancel</button>
                    </div>
                    <ul id="projectFileTree" class="file-tree-list" role="listbox" aria-label="Project Files">
                        <!-- File items will be populated by JS -->
                    </ul>
                </div>
                <pre id="codeOutput" role="textbox" aria-multiline="true" aria-label="Code editor content" contenteditable="true"><code>No code generated yet. Enter a prompt to start.</code></pre>
            </div>
        </div>
        <div class="panel-resizer" id="resizerEditorPreview"></div>
        <div id="previewPanel" class="panel">
            <div class="panel-header">
                <h3>Live Preview</h3>
                <div>
                    <button id="reloadPreviewButton" class="panel-header-button preview-icon-button" aria-label="Reload Preview" title="Reload Preview">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    </button>
                    <button id="selectElementsToggle" class="panel-header-button preview-icon-button" aria-label="Toggle Element Selection Mode" title="Toggle Element Selection Mode">
                         <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg> <!-- Placeholder, update icon -->
                    </button>
                    <button id="dragElementToggle" class="panel-header-button preview-icon-button" aria-label="Toggle Element Drag Mode" title="Toggle Element Drag Mode">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20l-8-8m8 8l8-8m-8-8l-8 8m8-8l8 8"/></svg> <!-- Placeholder Drag Icon -->
                    </button>
                    <button id="popOutButton" class="panel-header-button preview-icon-button" aria-label="Pop-out Preview into New Window" title="Pop-out Preview">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>
                    </button>
                    <button id="fullscreenButton" class="panel-header-button preview-icon-button" aria-label="Toggle Fullscreen Preview" title="Toggle Fullscreen">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                    </button>
                    <button id="togglePreviewPanelButton" class="panel-header-button panel-content-toggle" aria-label="Minimize Preview Panel" aria-expanded="true" title="Minimize Preview Panel">
                        <svg class="icon icon-toggle-panel" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
                    </button>
                </div>
            </div>
            <iframe id="previewFrame" class="panel-content" title="App Preview" sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms"></iframe>
        </div>
    </main>

    <div id="settingsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="settingsModalTitle">Settings</h2>
                <div class="tabs" role="tablist">
                    <button class="tab-button active" role="tab" aria-selected="true" aria-controls="uiSettingsTab" data-tab="uiSettingsTab">UI</button>
                    <button class="tab-button" role="tab" aria-selected="false" aria-controls="modelSettingsTab" data-tab="modelSettingsTab">Models</button>
                    <button class="tab-button" role="tab" aria-selected="false" aria-controls="docsSettingsTab" data-tab="docsSettingsTab">Docs</button>
                    <button class="tab-button" role="tab" aria-selected="false" aria-controls="generalSettingsTab" data-tab="generalSettingsTab">General</button>
                    <button class="tab-button" role="tab" aria-selected="false" aria-controls="aboutSettingsTab" data-tab="aboutSettingsTab">About</button>
                </div>
                <button id="closeSettingsModal" class="close-button" aria-label="Close Settings">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="uiSettingsTab" class="tab-content active" role="tabpanel" aria-labelledby="uiSettingsTabButton">
                    <h3>UI Settings</h3>
                    <div class="setting-item">
                        <label for="darkModeToggle">Dark Mode</label>
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="tooltipsToggle">Enable Tooltips</label>
                        <label class="switch">
                            <input type="checkbox" id="tooltipsToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="autoCreateCheckpointToggle">Auto-create checkpoints on prompt</label>
                        <label class="switch">
                            <input type="checkbox" id="autoCreateCheckpointToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

                <div id="modelSettingsTab" class="tab-content" role="tabpanel" aria-labelledby="modelSettingsTabButton">
                    <h3>API & Model Selection</h3>
                     <div class="setting-item">
                        <label for="geminiApiToggle">Enable Gemini API</label>
                        <label class="switch">
                            <input type="checkbox" id="geminiApiToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <p class="settings-group-label">Select Puter.com models (active if Gemini API is disabled):</p>
                    <div id="modelListContainer" role="listbox" aria-label="Select Puter.com Models" aria-multiselectable="true"></div>
                    <button id="saveModelsButton" class="modal-action-button">Save Puter Model Selection</button>
                </div>
                
                <div id="docsSettingsTab" class="tab-content" role="tabpanel" aria-labelledby="docsSettingsTabButton">
                    <h3>AI Context Documents</h3>
                    <p class="settings-description">Manage documents to provide context/knowledge to the AI. Active documents will be used in prompts. Documents are stored in your Puter cloud storage.</p>
                    <p id="aiDocsStorageAlert" class="settings-info-text error-text hidden" role="alert"></p>
                    
                    <div class="ai-docs-toolbar">
                        <button id="uploadAiDocButton" class="modal-action-button icon-button" title="Upload .txt or .md files">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/></svg>
                            Upload Docs
                        </button>
                        <input type="file" id="aiDocFileInput" class="hidden" multiple accept=".txt,.md,.text,text/plain,text/markdown">
                        <button id="typeOrEditAiDocButton" class="modal-action-button icon-button" title="Type or Edit a Document">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                            Type New Doc
                        </button>
                    </div>

                    <div id="typeAiDocFormContainer" class="hidden ai-doc-form" role="form" aria-labelledby="typeAiDocFormTitle">
                        <h4 id="typeAiDocFormTitle">Type New Document</h4>
                        <div>
                            <label for="aiDocTitleInput">Document Title (e.g., my_api_notes.txt):</label>
                            <input type="text" id="aiDocTitleInput" placeholder="Enter title...">
                        </div>
                        <div>
                            <label for="aiDocContentInput">Document Content:</label>
                            <div class="textarea-wrapper">
                                <textarea id="aiDocContentInput" rows="6" placeholder="Paste or type document content..."></textarea>
                                <button id="pasteAiDocContentButton" class="icon-button paste-button" aria-label="Paste content" title="Paste content from clipboard">
                                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0S9.6.84 9.18 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="ai-doc-form-actions">
                            <button id="saveTypedAiDocButton" class="modal-action-button primary">Save Document</button>
                            <button id="cancelTypedAiDocButton" class="modal-action-button">Cancel</button>
                        </div>
                    </div>
                    
                    <p id="noAiDocsMessage" class="settings-info-text">No context documents uploaded yet.</p>
                    <div id="aiDocsListContainer" class="ai-docs-list" role="listbox" aria-label="AI Context Documents">
                        <!-- AI Docs will be listed here -->
                    </div>
                </div>

                <div id="generalSettingsTab" class="tab-content" role="tabpanel" aria-labelledby="generalSettingsTabButton">
                    <h3>General Settings</h3>
                    <div class="setting-item">
                        <label for="appMemoryToggle">Enable App Memory (Chat History)</label>
                        <label class="switch">
                            <input type="checkbox" id="appMemoryToggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="fileContextToggle">Enable File Context (Experimental)</label>
                        <label class="switch">
                            <input type="checkbox" id="fileContextToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="showWelcomeModalToggle">Show Welcome Modal on Startup</label>
                        <label class="switch">
                            <input type="checkbox" id="showWelcomeModalToggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

                <div id="aboutSettingsTab" class="tab-content" role="tabpanel" aria-labelledby="aboutSettingsTabButton">
                    <h3>About JR Vibe Code</h3>
                    <p>
                        Created by <a href="https://jayreddin.github.io" target="_blank" rel="noopener noreferrer">Jamie Reddin</a> using the <a href="https://puter.com" target="_blank" rel="noopener noreferrer">Puter.com</a> <a href="https://docs.puter.com" target="_blank" rel="noopener noreferrer">API</a> and Google Gemini API. || Version <span id="appVersion">1.2.0</span>
                    </p>
                    <h4>Features:</h4>
                    <ul id="featuresList">
                        <li>AI-driven Development (HTML, CSS, JS)</li>
                        <li>Live Preview & Pop-out Interactive Editor</li>
                        <li>Multi-File Management (Create, Upload, Edit Tabs)</li>
                        <li>Granular Element Control (Manual & AI)</li>
                        <li>Flexible API & Model Choice (Puter/Gemini)</li>
                        <li>Persistent Workspace (Files, Settings, Checkpoints)</li>
                        <li>Code Checkpoints (Manual & Automatic Restore)</li>
                        <li>Welcome Modal with Starter Templates (Blank, Basic Web, Puter App)</li>
                        <li>Puter App template uses Puter.js docs as AI knowledge base</li>
                        <li>AI Context Documents (via Settings > Docs) with Puter Cloud Storage</li>
                    </ul>
                </div>
            </div>
            <!-- Footer is removed, actions are within tabs or header -->
        </div>
    </div>

    <div id="restoreCheckpointsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="restoreCheckpointsModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="restoreCheckpointsModalTitle">View & Restore Checkpoints</h2>
                <button id="closeRestoreCheckpointsModal" class="close-button" aria-label="Close Restore Checkpoints Modal">
                     <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="checkpointsListContainer" class="tab-content active" role="listbox" aria-label="Available Checkpoints" style="padding: 20px;">
                    <!-- Checkpoints will be listed here by JS -->
                    <p id="noCheckpointsMessage" class="settings-info-text">No checkpoints available to restore.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelRestoreCheckpointButton" class="modal-action-button">Cancel</button>
            </div>
        </div>
    </div>

    <div id="confirmNewProjectModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmNewProjectModalTitle">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmNewProjectModalTitle">Start New Project?</h2>
                <button id="closeConfirmNewProjectModal" class="close-button" aria-label="Close Confirmation">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="tab-content active" style="padding: 20px;">
                    <p>This will clear your current workspace and start a new blank project. Are you sure?</p>
                    <p class="settings-description" style="font-size: 0.85em;">(Your saved checkpoints will remain available.)</p>
                </div>
            </div>
            <div class="modal-footer" style="justify-content: space-between;">
                <button id="confirmNewProjectCancelButton" class="modal-action-button">Cancel</button>
                <button id="confirmNewProjectConfirmButton" class="modal-action-button primary-confirm-button">Confirm New Project</button>
            </div>
        </div>
    </div>

    <div id="welcomeModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="welcomeModalTitle">
        <div class="modal-content" style="max-width: 600px;"> <!-- Increased max-width for new layout -->
            <div class="modal-header welcome-modal-header">
                <img id="welcomeModalLogo" src="Imgs/applogo.jpg" alt="App Logo" class="welcome-logo"> <!-- Add your app logo image -->
                <h2 id="welcomeModalTitle">Welcome to JR Vibe Code!</h2>
            </div>
            <div class="modal-body">
                <div id="welcomeAuthContainer" class="welcome-auth-container">
                    <button id="welcomeLoginButton" class="modal-action-button primary">Login to Puter</button>
                    <span id="welcomeUsernameDisplay" class="welcome-username hidden"></span>
                </div>
                
                <div class="welcome-project-name-container">
                    <label for="welcomeProjectNameInput">Vibe Code Project Name:</label>
                    <input type="text" id="welcomeProjectNameInput" class="app-project-name-input" value="Vibe Code Project">
                </div>

                <p class="template-selection-title">Choose a template to start your project:</p>
                <div id="templateSelectionContainer" class="template-grid">
                    <button class="template-grid-button" data-template="blank" aria-label="Start with a blank project">
                        <span class="template-icon">🚀</span>
                        <span class="template-text">Blank Project</span>
                    </button>
                    <button class="template-grid-button" data-template="puter_app" aria-label="Start with a Puter.js app template">
                        <img src="Imgs/putericon.png" alt="Puter Icon" class="template-image-icon"> <!-- Add Puter icon image -->
                        <span class="template-text">Puter App</span>
                    </button>
                    <button class="template-grid-button" data-template="html_css_js" aria-label="Start with a basic HTML, CSS, and JavaScript setup">
                         <span class="template-icon">🌐</span>
                        <span class="template-text">Basic Web (HTML, CSS, JS)</span>
                    </button>
                    <button class="template-grid-button" data-template="community" aria-label="Explore community templates (coming soon)">
                        <span class="template-icon">🌟</span>
                        <span class="template-text">Community Templates</span>
                    </button>
                </div>
                
                <div class="welcome-modal-footer">
                    <div class="setting-item" style="padding: 8px 0; border-bottom: none;">
                        <label for="hideWelcomeModalToggle">Never show this welcome message again</label>
                        <label class="switch">
                            <input type="checkbox" id="hideWelcomeModalToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <p id="welcomeVersionText" class="welcome-version-text"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="aiHistoryModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="aiHistoryModalTitle">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="aiHistoryModalTitle">AI Prompt History</h2>
                <button id="closeAiHistoryModal" class="close-button" aria-label="Close AI History">
                     <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="noAiHistoryMessage" class="settings-info-text">No AI interactions recorded yet.</p>
                <ul id="aiHistoryList" class="ai-history-list">
                    <!-- History items will be populated by JS -->
                </ul>
            </div>
        </div>
    </div>
    

    <script type="module" src="index.js"></script>
</body>
</html>
<link rel="stylesheet" href="index.css">
<script src="index.tsx" type="module"></script>
